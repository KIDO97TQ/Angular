<div class="settings-page">

    <h2>C√†i ƒë·∫∑t</h2>

    <!-- ACCOUNT INFO -->
    <section class="card">
        <h3>Th√¥ng tin t√†i kho·∫£n</h3>
        <p><strong>T√™n:</strong> {{ authService.user$ | async }}</p>
        <p><strong>T√™n:</strong> {{ authService.userphone$ | async }}</p>
        <p><strong>Ng√†y tham gia:</strong> {{ authService.userdate$ | async | date:'dd/MM/yyyy' }}</p>
    </section>

    <!-- THEME -->
    <section class="card">
        <h3>Giao di·ªán</h3>
        <button class="theme-btn" (click)="toggleTheme()">
            <i class="bi bi-moon-stars"></i>
            Chuy·ªÉn ch·∫ø ƒë·ªô s√°ng / t·ªëi
        </button>
    </section>

    <!-- PASSWORD -->
    <section class="card">
        <h3>ƒê·ªïi m·∫≠t kh·∫©u</h3>

        <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
            <div class="input-group">
                <input [type]="showCurrent ? 'text' : 'password'" placeholder="M·∫≠t kh·∫©u hi·ªán t·∫°i"
                    formControlName="currentPassword" (blur)="checkCurrentPassword()" />

                <!-- üîÑ Loading -->
                <i *ngIf="isChecking" class="bi bi-arrow-repeat spin icon"></i>

                <!-- ‚úî ƒê√∫ng -->
                <i *ngIf="!isChecking && isCurrentPasswordValid" class="bi bi-check-circle-fill success icon"></i>

                <!-- ‚úñ Sai -->
                <i *ngIf="!isChecking && passwordForm.get('currentPassword')?.errors?.['wrongPassword']"
                    class="bi bi-x-circle-fill error icon"></i>

                <!-- üëÅ M·∫∑c ƒë·ªãnh -->
                <i *ngIf="!isChecking 
            && !isCurrentPasswordValid 
            && !passwordForm.get('currentPassword')?.errors?.['wrongPassword']" class="bi"
                    [ngClass]="showCurrent ? 'bi-eye-slash' : 'bi-eye'" (click)="togglePassword('current')">
                </i>
            </div>

            <div *ngIf="passwordForm.get('currentPassword')?.errors?.['wrongPassword']" class="error-text">
                M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng
            </div>

            <div class="input-group">
                <input [type]="showNew ? 'text' : 'password'" placeholder="M·∫≠t kh·∫©u m·ªõi" formControlName="newPassword">
                <i class="bi" [ngClass]="showNew ? 'bi-eye-slash' : 'bi-eye'" (click)="togglePassword('new')"></i>
            </div>

            <div class="input-group">
                <input [type]="showRenew ? 'text' : 'password'" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"
                    formControlName="renewPassword">
                <i class="bi" [ngClass]="showRenew ? 'bi-eye-slash' : 'bi-eye'" (click)="togglePassword('renew')"></i>
            </div>
            <div class="error-text" *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.touched">
                M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp
            </div>

            <button type="submit" [disabled]="passwordForm.invalid || !isCurrentPasswordValid">
                C·∫≠p nh·∫≠t m·∫≠t kh·∫©u
            </button>
        </form>
    </section>

    <!-- SECURITY -->
    <section class="card danger">
        <h3>B·∫£o m·∫≠t</h3>
        <button class="danger-btn" (click)="logoutAll()">
            <i class="bi bi-shield-lock"></i>
            ƒêƒÉng xu·∫•t kh·ªèi t·∫•t c·∫£ thi·∫øt b·ªã
        </button>
    </section>

</div>